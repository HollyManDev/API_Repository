<?php
// Incluindo o arquivo de conexão com o banco de dados
include 'conexao_BD.php';

// Consulta SQL para selecionar todos os registros da tabela 'restaurantes'
$sql = "SELECT * FROM restaurantes";
$result = $conn->query($sql); // Executa a consulta SQL e armazena o resultado
?>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"> <!-- Configura a codificação de caracteres -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Configura o viewport para dispositivos móveis -->
    <title>Cadastro de Restaurante</title> <!-- Título da página -->
    <style>
        /* Estilos CSS para a tabela e suas células */
        table, th, td {
            border: 1px solid black; /* Define as bordas da tabela e células */
            border-collapse: collapse; /* Faz com que as bordas se fundam */
        }
        th, td {
            padding: 10px; /* Espaçamento interno das células */
        }
    </style>
</head>
<body>

<div>
    <h2>Cadastro de Restaurante</h2>
    <!-- Formulário para cadastrar ou atualizar um restaurante -->
    <form id="restaurante-form" action="cadastro_restaurante.php" method="post">
        <input type="hidden" id="restaurante-id" name="id"> <!-- Campo oculto para armazenar o ID do restaurante (para atualização) -->
        <label for="nome">Nome do Restaurante:</label><br>
        <input type="text" id="nome" name="nome" required><br><br> <!-- Campo para o nome do restaurante -->
        <label for="telefone">Telefone:</label><br>
        <input type="text" id="telefone" name="telefone" required><br><br> <!-- Campo para o telefone do restaurante -->
        <label for="localizacao">Localização:</label><br>
        <input type="text" id="localizacao" name="localizacao" required><br><br> <!-- Campo para a localização do restaurante -->
        <input type="submit" value="Cadastrar/Atualizar"> <!-- Botão para enviar o formulário (Cadastrar ou Atualizar) -->
    </form>
</div>

<!-- Tabela para exibir os restaurantes -->
<table id="restaurantes-table">
    <thead>
        <tr>
            <th>Id</th>
        <th>Nome</th>
            <th>Localização</th>
            <th>Telefone</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        <?php
            // Itera sobre cada registro retornado pela consulta
            while($info = mysqli_fetch_assoc($result)){
                // Cria uma linha da tabela com os dados do restaurante
                echo "<tr class='restaurante-row' data-id='".$info['id']."' data-nome='".$info['nome']."' data-localizacao='".$info['localizacao']."' data-telefone='".$info['telefone']."'>";
                echo "<td>".$info['id']."</td>"; // Coluna de ID
                echo "<td>".$info['nome']."</td>"; // Coluna de Nome
                echo "<td>".$info['localizacao']."</td>"; // Coluna de Localização
                echo "<td>".$info['telefone']."</td>"; // Coluna de Telefone
                // Botão para editar a linha
                echo "<td><button type='button' class='edit-btn'>Editar</button></td>";
                echo "</tr>";
            }
        ?>
    </tbody>
</table>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        // Seleciona todas as linhas da tabela com a classe 'restaurante-row'
        const rows = document.querySelectorAll('.restaurante-row');
        rows.forEach(row => {
            // Adiciona um evento de clique ao botão 'Editar' de cada linha
            row.querySelector('.edit-btn').addEventListener('click', () => {
                // Obtém os dados da linha selecionada
                const id = row.getAttribute('data-id');
                const nome = row.getAttribute('data-nome');
                const localizacao = row.getAttribute('data-localizacao');
                const telefone = row.getAttribute('data-telefone');
                // Preenche os campos do formulário com os dados da linha selecionada
                document.getElementById('restaurante-id').value = id;
                document.getElementById('nome').value = nome;
                document.getElementById('localizacao').value = localizacao;
                document.getElementById('telefone').value = telefone;
            });
        });
    });
</script>

</body>
</html>
